@model List<DisnApp.ViewModel.ConversacionVM>

@{
    var busqueda = ViewBag.txtBusqueda as string ?? "";
}


<div class="container-fluid p-0 chat-container shadow-sm bg-white">
    <div class="row g-0 chat-shell">

        <aside class="col-12 col-md-4 col-lg-3 border-end bg-light d-flex flex-column chat-sidebar">
            <!-- Header -->
            <div class="p-3 bg-white border-bottom d-flex align-items-center justify-content-between flex-shrink-0">
                <h5 class="fw-bold mb-0">Mensajes</h5>
            </div>

            <!-- Search -->
            <div class="p-3 bg-white border-bottom flex-shrink-0">
                <form id="filtroChatsForm"
                      asp-controller="Mensaje"
                      asp-action="GetChatStartCandidates"
                      method="get"
                      class="d-flex gap-2 align-items-center">

                    <div class="input-group">
                        <span class="input-group-text bg-light border-0">
                            <span class="material-symbols-outlined text-muted">search</span>
                        </span>

                        <input type="text"
                               class="form-control bg-light border-0 shadow-none"
                               name="txtBusqueda"
                               value="@busqueda"
                               placeholder="Buscar usuario..."
                               aria-label="Buscar usuario" />

                        <button type="submit" class="btn btn-primary">
                            Filtrar
                        </button>
                    </div>
                </form>
            </div>
            <!-- List -->
            <div id="bandejaContainer">
                @await Html.PartialAsync("~/Views/Mensaje/_Bandeja.cshtml", Model)
            </div>
        </aside>

        <div class="modal fade" id="chatModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-side">
                <div class="modal-content h-100">

                    <div class="modal-header">
                        <h5 class="modal-title">Chat</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body p-0" id="chatModalBody">
                        <div class="text-center p-4">Seleccioná un chat…</div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<style>
    .chat-container {
        height: 100vh; /* o calc(100vh - 56px) si tenés navbar */
        overflow: hidden;
        border-radius: 16px; /* opcional, para que se vea bien con shadow */
    }

    .chat-shell {
        height: 100%;
    }

    .chat-sidebar {
        height: 100%;
        min-height: 0; /* IMPORTANTÍSIMO para que el scroll funcione */
    }

    .sidebar-scroll {
        overflow-y: auto;
        min-height: 0; /* IMPORTANTÍSIMO */
    }

    /* Si no tenías esta clase, definila así */
    .avatar-md {
        width: 44px;
        height: 44px;
        object-fit: cover;
    }

    /* Bootstrap no trae min-width-0 como clase */
    .min-width-0 {
        min-width: 0;
    }
</style>